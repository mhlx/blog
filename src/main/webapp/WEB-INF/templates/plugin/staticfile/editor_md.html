
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
<link rel="stylesheet"
	th:href="@{/static/bootstrap/css/bootstrap.min.css}" />
<link th:href="@{/static/fontawesome-free/css/all.min.css?v=7.0}"
	rel="stylesheet">
<title>文件编辑</title>
</head>
<body>

	<div class="container-fluid"
		style="padding-left: 0px; padding-right: 0px">
		<textarea id="code" name="code" rows="5"
			style="width: 100%; border: none" th:text="${file.content}"></textarea>
		<div class="btn-group" role="group"
			style="position: absolute; right: 10px; bottom: 10px">
			<button type="button" id="leave-btn" class="btn btn-primary">返回</button>
			<button type="button" id="save-btn" class="btn btn-primary">保存</button>
		</div>
	</div>

	<div th:replace="console/base/foot"></div>
	<script th:src="@{/static/console/markdowniteditor/common/iframe.js}"></script>
	<script>
	var path = '[[${file.path}]]';
	$("#code").height($(window).height()-10);
	var editor = $("#editor");
	commonEditor.bind('#code', {
		 basePath : '[[@{/}]]',
		 isLogin : true,
		 csrfToken : '[[${_csrf.token}]]',
		csrfHeader : '[[${_csrf.headerName}]]' 
	});
	$("#save-btn").click(function(){
		 $.ajax({
			type : 'PUT',
			url : root + 'api/console/staticFile',
			data:{'path':path,'content':$("#code").val()},
			success:function(data) {
				swal('保存成功','','success');
			},
			error:function(jqXHR, textStatus, errorThrown) {
				var data = $.parseJSON(jqXHR.responseText);
				swal('保存失败',data.error,'error');
			}
		  })
	});
	$(document).keyup(function(e){

	    if(e.keyCode === 27){
	    	leave();
	    }

	});
	
	$("#leave-btn").click(function(){
		leave();
	})
	
	var leave = function(){
		swal({
			  title: '你确定要离开码？',
			  text: "没有保存的内容将会丢失",
			  type: 'warning',
			  showCancelButton: true,
			  confirmButtonColor: '#3085d6',
			  cancelButtonColor: '#d33',
			  confirmButtonText: '离开!',
			  cancelButtonText: '取消'
			}).then((result) => {
			  if (result.value) {
				  window.history.go(-1);
			  }
			});
	}
	</script>


</body>