
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
<link rel="stylesheet"
	th:href="@{/static/bootstrap/css/bootstrap.min.css}">
<link th:href="@{/static/fontawesome-free/css/all.min.css}"
	rel="stylesheet">
<link rel="stylesheet"
	th:href="@{/static/jquery-file-upload/css/jquery.fileupload.css}">
<link rel="stylesheet"
	th:href="@{/static/codemirror/lib/codemirror.css}">
<link rel="stylesheet" th:href="@{/static/css/markdown.css}">
<link rel="stylesheet" th:href="@{/static/heather/style.css}">
<link rel="stylesheet" th:href="@{/static/heather/highlight/styles/github.css}">
<link rel="stylesheet" th:href="@{/static/codemirror/addon/dialog/dialog.css}">
<link rel="stylesheet" th:href="@{/static/codemirror/addon/display/fullscreen.css}">
<title>文件编辑</title>
<style>
.swal2-container.swal2-shown {
	z-index: 99999999
}
.modal {
	z-index: 99999998
}
.modal-backdrop{
	z-index: 99999997
}
</style>
</head>
<body>

	<div class="container-fluid"
		style="padding-left: 0px; padding-right: 0px">
		<textarea id="code" name="code"  th:text="${file.content}" style="display:none"></textarea>
	</div>

	<div th:replace="console/base/foot"></div>
	<script>var rootPath = root</script>
	<script th:src="@{/static/console/js/dirChooser.js}"></script>
		<script th:src="@{/static/heather/highlight/highlight.pack.js}"></script>
	<!--CodeMirror-->
	<script th:src="@{/static/codemirror/lib/codemirror.js}"></script>
	<script th:src="@{/static/codemirror/addon/mode/overlay.js}"></script>
	<script th:src="@{/static/codemirror/mode/xml/xml.js}"></script>
	<script th:src="@{/static/codemirror/mode/markdown/markdown.js}"></script>
	<script th:src="@{/static/codemirror/mode/gfm/gfm.js}"></script>
	<script
		th:src="@{/static/codemirror/addon/selection/mark-selection.js}"></script>
	<script th:src="@{/static/codemirror/addon/search/searchcursor.js}"></script>
	<script th:src="@{/static/codemirror/addon/search/search.js}"></script>
	<script th:src="@{/static/codemirror/addon/edit/continuelist.js}"></script>
	<script th:src="@{/static/codemirror/addon/dialog/dialog.js}"></script>
	<script th:src="@{/static/codemirror/addon/display/fullscreen.js}"></script>
	<script th:src="@{/static/heather/js/markdown-it.min.js}"></script>
	<script th:src="@{/static/heather/js/markdown-it-task-lists.min.js}"></script>
	<script th:src="@{/static/heather/js/markdown-it-katex.min.js}"></script>
	<script th:src="@{/static/heather/js/heather.js}"></script>

	<script type="text/javascript"
		th:src="@{/static/jquery-file-upload/js/load-image.min.js}"></script>
	<script type="text/javascript"
		th:src="@{/static/js/canvas-to-blob.min.js}"></script>
	<script
		th:src="@{/static/jquery-file-upload/js/vendor/jquery.ui.widget.js}"></script>
	<script
		th:src="@{/static/jquery-file-upload/js/jquery.iframe-transport.js}"></script>
	<script th:src="@{/static/jquery-file-upload/js/jquery.fileupload.js}"></script>
	<script
		th:src="@{/static/jquery-file-upload/js/jquery.fileupload-ui.js}"></script>
	<script
		th:src="@{/static/jquery-file-upload/js/jquery.fileupload-process.js}"></script>
	<script
		th:src="@{/static/jquery-file-upload/js/jquery.fileupload-image.js}"></script>
	<script
		th:src="@{/static/jquery-file-upload/js/jquery.fileupload-audio.js}"></script>
	<script
		th:src="@{/static/jquery-file-upload/js/jquery.fileupload-video.js}"></script>
	<script
		th:src="@{/static/jquery-file-upload/js/jquery.fileupload-validate.js}"></script>
	<script th:src="@{/static/js/file.js}"></script>
	<script th:src="@{/static/console/js/file_insert.js}"></script>
	<script>
	var path = '[[${file.path}]]';
	
    Heather.lazyRes.mermaid_js=rootPath+'static/heather/js/mermaid.min.js';
    Heather.lazyRes.katex_css=rootPath+'static/heather/katex/katex.min.css';
    Heather.lazyRes.katex_js=rootPath+'static/heather/katex/katex.min.js';
   
    
	var heather = Heather.create(document.getElementById('code'),{
		markdownParser:{
			html : true,
			linkify:true
		}
	})
	
	var toolbar = heather.getToolbar();
	
	toolbar.addIcon('fas fa-backward heather_icon',function(){
		Swal.fire({
		  title: '你确定要离开码？',
		  text: "没有保存的内容将会丢失",
		  type: 'warning',
		  showCancelButton: true,
		  confirmButtonColor: '#3085d6',
		  cancelButtonColor: '#d33',
		  confirmButtonText: '离开!',
		  cancelButtonText: '取消'
		}).then((result) => {
		  if (result.value) {
			  window.history.go(-1);
		  }
		});
	});

	toolbar.addIcon('fas fa-save heather_icon',function(){
		 $.ajax({
			type : 'PUT',
			url : root + 'api/console/staticFile',
			data:{'path':path,'content':heather.getValue()},
			success:function(data) {
				Swal.fire('保存成功','','success');
			},
			error:function(jqXHR, textStatus, errorThrown) {
				var data = $.parseJSON(jqXHR.responseText);
				Swal.fire('保存失败',data.error,'error');
			}
		  })
	});
	
	toolbar.addIcon('fas fa-file heather_icon',function(){
		 files.get(heather.editor);
	});
	if(Heather.Util.mobile){
		toolbar.addIcon('fas fa-arrows-alt heather_icon', function() {
			if(!heather.hasSelectionHelper()){
				heather.openSelectionHelper();
			} else {
				heather.closeSelectionHelper();
			}
		});
	}
	heather.setFullscreen(true);
	
</script>


</body>