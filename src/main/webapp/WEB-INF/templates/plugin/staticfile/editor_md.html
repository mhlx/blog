
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
<link rel="stylesheet"
	th:href="@{/static/bootstrap/css/bootstrap.min.css}" />
<link th:href="@{/static/fontawesome-free/css/all.min.css?v=7.0}"
	rel="stylesheet">
<title>文件编辑</title>
<style>
.swal2-container.swal2-shown {
	z-index: 9999999
}
.modal {
	z-index: 9999998
}
.modal-backdrop{
	z-index: 9999997
}
</style>
</head>
<body>

	<div class="container-fluid"
		style="padding-left: 0px; padding-right: 0px">
		<textarea id="code" name="code"  th:text="${file.content}" style="display:none"></textarea>
	</div>

	<div th:replace="console/base/foot"></div>
	<script>var rootPath = root</script>
	<script th:src="@{/static/heather/iframe.js}"></script>
	<script>
	var path = '[[${file.path}]]';
	Editor.create($("#code")[0],function(editor){
		editor.toolbarHelper.insertIcon(['fas','fa-backward'],function(){
			swal({
			  title: '你确定要离开码？',
			  text: "没有保存的内容将会丢失",
			  type: 'warning',
			  showCancelButton: true,
			  confirmButtonColor: '#3085d6',
			  cancelButtonColor: '#d33',
			  confirmButtonText: '离开!',
			  cancelButtonText: '取消'
			}).then((result) => {
			  if (result.value) {
				  window.history.go(-1);
			  }
			});
		});

		editor.toolbarHelper.insertIcon(['fas','fa-save'],function(){
			 $.ajax({
				type : 'PUT',
				url : root + 'api/console/staticFile',
				data:{'path':path,'content':editor.editor.getValue()},
				success:function(data) {
					swal('保存成功','','success');
				},
				error:function(jqXHR, textStatus, errorThrown) {
					var data = $.parseJSON(jqXHR.responseText);
					swal('保存失败',data.error,'error');
				}
			  })
		},2);
	})
	
	</script>


</body>