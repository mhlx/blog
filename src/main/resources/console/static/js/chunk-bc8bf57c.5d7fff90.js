(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bc8bf57c"],{"09f4":function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),Math.easeInOutQuad=function(e,t,a,n){return e/=n/2,e<1?a/2*e*e+t:(e--,-a/2*(e*(e-2)-1)+t)};var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function i(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function r(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function l(e,t,a){var l=r(),o=e-l,c=20,s=0;t="undefined"===typeof t?500:t;var u=function e(){s+=c;var r=Math.easeInOutQuad(s,l,o,t);i(r),s<t?n(e):a&&"function"===typeof a&&a()};u()}},2423:function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"b",(function(){return r})),a.d(t,"f",(function(){return l})),a.d(t,"a",(function(){return o})),a.d(t,"d",(function(){return c})),a.d(t,"e",(function(){return s}));var n=a("b775");function i(e){return Object(n["a"])({url:"/articles",method:"get",params:e})}function r(e){return Object(n["a"])({url:"/articles/"+e,method:"delete"})}function l(e){return Object(n["a"])({url:"/articles/"+e.id,method:"put",data:e,showError:!1})}function o(e){return Object(n["a"])({url:"/article",method:"post",data:e,showError:!1})}function c(e){return Object(n["a"])({url:"/editableArticles/"+e,method:"get"})}function s(e){return Object(n["a"])({url:"/articles/"+e,method:"get"})}},"25f8":function(e,t,a){"use strict";var n=a("c9af"),i=a.n(n);i.a},"3f5e":function(e,t,a){"use strict";a.d(t,"d",(function(){return i})),a.d(t,"b",(function(){return r})),a.d(t,"e",(function(){return l})),a.d(t,"c",(function(){return o})),a.d(t,"f",(function(){return c})),a.d(t,"a",(function(){return s}));var n=a("b775");function i(e){return Object(n["a"])({url:"/files",method:"get",params:e})}function r(e){return Object(n["a"])({url:"/file",method:"post",data:e})}function l(e){return Object(n["a"])({url:"file",method:"get",params:{path:e}})}function o(e){return Object(n["a"])({url:"file",method:"delete",params:{path:e}})}function c(e,t){return Object(n["a"])({url:"file",method:"patch",params:{path:e},data:t})}function s(e,t){return Object(n["a"])({url:"file",method:"post",params:{path:e,dir:t}})}},"46c7":function(e,t,a){e.exports=a.p+"static/img/file.c1cdb1da.svg"},abfe:function(e,t,a){e.exports=a.p+"static/img/folder.f4979b25.svg"},c405:function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return r})),a.d(t,"d",(function(){return l})),a.d(t,"b",(function(){return o}));var n=a("b775");function i(){return Object(n["a"])({url:"/categories",method:"get"})}function r(e){return Object(n["a"])({url:"/category",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/categories/"+e.id,method:"put",data:e})}function o(e){return Object(n["a"])({url:"/categories/"+e,method:"delete"})}},c9af:function(e,t,a){},fbee:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{attrs:{model:e.article},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.backToList}},[e._v("返回")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmArticle}},[e._v("保存")])],1),e._v(" "),a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{model:{value:e.article.title,callback:function(t){e.$set(e.article,"title",t)},expression:"article.title"}})],1),e._v(" "),a("markdown-editor",{ref:"editor",staticStyle:{"margin-bottom":"20px"},attrs:{"preview-style":"tab",height:"600px"},on:{contentChanged:e.onContentChange}}),e._v(" "),a("el-form-item",{attrs:{label:"摘要"}},[a("markdown-editor",{ref:"summaryEditor",staticStyle:{width:"100%",clear:"both"},attrs:{"preview-style":"tab"},on:{contentChanged:e.onContentChange}})],1),e._v(" "),a("el-form-item",{attrs:{label:"别名"}},[a("el-input",{model:{value:e.article.alias,callback:function(t){e.$set(e.article,"alias",t)},expression:"article.alias"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分类"}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择","value-key":"id"},model:{value:e.article.categories,callback:function(t){e.$set(e.article,"categories",t)},expression:"article.categories"}},e._l(e.categories,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"标签","label-position":"top"}},[e._l(e.article.tags,(function(t){return a("el-tag",{key:t.name,attrs:{closable:"","disable-transitions":!1},on:{close:function(a){return e.handleClose(t.name)}}},[e._v("\n        "+e._s(t.name)+"\n      ")])})),e._v(" "),e.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v("新标签")])],2),e._v(" "),a("el-form-item",{attrs:{label:"特征图像"}},[a("el-input",{model:{value:e.article.featureImage,callback:function(t){e.$set(e.article,"featureImage",t)},expression:"article.featureImage"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.selectFile},slot:"append"})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.onStatusChange},model:{value:e.article.status,callback:function(t){e.$set(e.article,"status",t)},expression:"article.status"}},[a("el-option",{key:"PUBLISHED",attrs:{label:"发布",value:"PUBLISHED"}}),e._v(" "),a("el-option",{key:"DRAFT",attrs:{label:"草稿",value:"DRAFT"}}),e._v(" "),a("el-option",{key:"SCHEDULED",attrs:{label:"计划",value:"SCHEDULED"}})],1)],1),e._v(" "),e.scheduleDateVisible?a("el-form-item",{attrs:{label:"发布时间"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.article.pubDate,callback:function(t){e.$set(e.article,"pubDate",t)},expression:"article.pubDate"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"置顶级别"}},[a("el-input-number",{attrs:{min:1,max:100},model:{value:e.article.level,callback:function(t){e.$set(e.article,"level",t)},expression:"article.level"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"访问密码"}},[a("el-input",{model:{value:e.article.password,callback:function(t){e.$set(e.article,"password",t)},expression:"article.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"允许评论"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":"true","inactive-value":"false"},model:{value:e.article.allowComment,callback:function(t){e.$set(e.article,"allowComment",t)},expression:"article.allowComment"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"私有"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":"true","inactive-value":"false"},model:{value:e.article.isPrivate,callback:function(t){e.$set(e.article,"isPrivate",t)},expression:"article.isPrivate"}})],1)],1),e._v(" "),a("file-selector",{ref:"fileSelector",attrs:{mode:"file",single:!0,exts:["jpeg","jpg","gif","png"]},on:{selected:e.selectedFile}})],1)},i=[],r=(a("7f7f"),a("6b54"),a("3e82")),l=a("2423"),o=a("c405"),c=a("16d8"),s=a("a18c"),u=a("4360"),f=a("ed08"),d={name:"ArticleEdit",components:{MarkdownEditor:c["a"],FileSelector:r["a"]},data:function(){return{article:{},categories:[],tag:"",inputVisible:!1,inputValue:"",scheduleDateVisible:!1}},watch:{article:{handler:function(e,t){void 0!==this.first&&(!0!==this.first?this.onContentChange():this.first=!1)},deep:!0}},created:function(){var e=this,t=this.$route.query.id;t?Object(l["d"])(t).then((function(t){if(t.allowComment=t.allowComment.toString(),t.isPrivate=t.isPrivate.toString(),0===t.level&&delete t.level,t.featureImage||(t.featureImage=""),t.categories=t.categories.map((function(e){return e.id})),delete t.resId,delete t.hasPassword,delete t.hits,delete t.comments,delete t.lastModifyDate,t.tags=t.tags.map((function(e){return{name:e.name}})),e.scheduleDateVisible="SCHEDULED"===t.status,e.scheduleDateVisible){var a=t.pubDate;t.pubDate=new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5])}e.article=t,e.first=!0,e.$refs.editor.setMarkdown(e.article.content),e.$refs.summaryEditor.setMarkdown(e.article.summary)})).catch((function(){u["a"].dispatch("tagsView/delView",e.$route),s["b"].push("/article/index")})):(u["a"].dispatch("tagsView/delView",this.$route),s["b"].push("/article/index")),Object(o["c"])().then((function(t){e.categories=t,0===e.categories.length&&(e.$message({type:"error",message:"编辑文章需要至少一个分类，请先添加一个分类"}),e.backToList())})).catch((function(){}))},methods:{onContentChange:function(){var e=this.$refs.editor.getMarkdown();if(this.article.content&&e!==this.article.content){this.timer&&clearTimeout(this.timer);var t=this;this.timer=setTimeout((function(){var a=Object.assign({},t.article);a.content=e,a.summary=t.$refs.summaryEditor.getMarkdown(),a.status="DRAFT",delete a.pubDate,Object(l["f"])(a).then((function(){})).catch((function(e){}))}),500)}},confirmArticle:function(){var e=this,t=Object.assign({},this.article);"SCHEDULED"===t.status?t.pubDate&&(t.pubDate=Object(f["f"])(t.pubDate)):delete t.pubDate,t.content=this.$refs.editor.getMarkdown(),t.summary=this.$refs.summaryEditor.getMarkdown(),Object(l["f"])(t).then((function(){e.$message({type:"success",message:"保存成功"}),e.backToList()})).catch((function(t){e.$message({type:"error",dangerouslyUseHTMLString:!0,message:t.message})}))},backToList:function(){u["a"].dispatch("tagsView/delView",this.$route),s["b"].push("/article/index")},handleClose:function(e){for(var t=this.article.tags.length-1;t>=0;t--)if(this.article.tags[t].name===e){this.article.tags.splice(t,1);break}},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick((function(t){e.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){var e=this.inputValue.trim();if(""!==e){var t=this.article.tags.filter((function(t){return t.name===e}));0===t.length&&this.article.tags.push({name:e})}this.inputVisible=!1,this.inputValue=""},selectFile:function(){this.$refs.fileSelector.select()},selectedFile:function(e){e.length>0&&(this.article.featureImage=e[0].url)},onStatusChange:function(){this.scheduleDateVisible="SCHEDULED"===this.article.status}}},m=d,p=(a("25f8"),a("2877")),h=Object(p["a"])(m,n,i,!1,null,null,null);t["default"]=h.exports}}]);