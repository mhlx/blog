<!doctype html>
<html>
<head th:replace="console/fragment/head('类别管理')"></head>
<body class="">
	<div class="page">
		<div class="flex-fill">
			<div th:replace="console/fragment/profile"></div>
			<div th:replace="console/fragment/headermenu('category')"></div>
			<div class="my-3 my-md-5">
				<div class="container">
					<div class="page-header">
						<div class="page-options d-flex">
							<div class="input-icon ml-2">
								<a class="btn btn-primary" id="create-btn"
									href="javascript:void(0)" style="margin-left: 20px"> <i
									class="far fa-plus-square"></i>
								</a>
							</div>
						</div>
					</div>
					<div class="row row-deck">
						<div class="col-12">
							<div class="card">
								<div class="table-responsive">
									<table class="table card-table table-vcenter text-nowrap">
										<thead>
											<tr>
												<th>名称</th>
												<th>创建时间</th>
												<th></th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="category : ${categories}">
												<td th:text="${category.name}"></td>
												<td th:text="${#times.format(category.createTime,'yyyy-MM-dd HH:mm:ss')}"></td>
												<td><a href="javascript:void(0)"
													th:data-trash="${category.id}"><i class="fas fa-trash"></i></a><span
													class="mr-1"></span> <a href="javascript:void(0)"
													th:data-edit="${category.id}"
													th:data-name="${category.name}"><i class="fas fa-edit"></i></a>
													<span class="mr-1"></span></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<footer th:replace="console/fragment/footer"></footer>
	</div>
	<script>
	
		document.getElementById('create-btn').addEventListener('click',function(){
			(async function getName () {
				const { value: name } = await Swal.fire({
					  title: '名称',
					  input: 'text',
					  inputValue: '',
					  showCancelButton: true
					})
			    if (name) {
			    	$.ajax({
						type : 'post',
						url : rootPath + 'console/category/save',
			            contentType: 'application/json',
						data:JSON.stringify({name : name}),
						success:function(data) {
							toast('保存成功');
							setTimeout(function(){
								window.location.reload();
							},800)
						}
					  })
				}
			})()
		});
		
		for(const ele of document.querySelectorAll('[data-trash]')){
			ele.addEventListener('click',function(){
				var id = this.dataset.trash;
				Swal.fire({
					  title: '确定删除吗？',
					  icon: 'warning',
					  showCancelButton: true,
					  confirmButtonColor: '#3085d6',
					  cancelButtonColor: '#d33'
					}).then((result) => {
					  if (result.value) {
						  	$.ajax({
								type : 'post',
								url : rootPath + 'console/category/'+id+'/delete',
								success:function(data) {
									toast('删除成功');
									setTimeout(function(){
										window.location.reload();
									},800)
								}
							  })
					  }
					})
			});
		}
		
		for(const ele of document.querySelectorAll('[data-edit]')){
			ele.addEventListener('click',function(){
				var id = this.dataset.edit;
				var oldName = this.dataset.name;
				(async function getName () {
					const { value: name } = await Swal.fire({
						  title: '名称',
						  input: 'text',
						  inputValue: oldName,
						  showCancelButton: true
						})
				    if (name) {
				    	$.ajax({
							type : 'post',
							url : rootPath + 'console/category/'+id+'/update',
				            contentType: 'application/json',
							data:JSON.stringify({name : name}),
							success:function(data) {
								toast('保存成功');
								setTimeout(function(){
									window.location.reload();
								},800)
							}
						  })
					}
				})()
			});
		}
	</script>
</body>
</html>