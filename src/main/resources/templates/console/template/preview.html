<!doctype html>
<html>
<head th:replace="console/fragment/head('预览管理')"></head>
<body class="">
	<div class="page">
		<div class="flex-fill">
			<div th:replace="console/fragment/profile"></div>
			<div th:replace="console/fragment/headermenu('template')"></div>
			<div class="my-3 my-md-5">
				<div class="container">
					<div class="page-header">
						<div class="page-options d-flex">
							<i id="clear" class="fas fa-trash btn btn-danger mr-4"></i>
							<i id="merge" class="fas fa-save btn btn-primary"></i>
						</div>
					</div>
					<div class="row row-deck">
						<div class="col-12">
							<div class="card">
								<div class="table-responsive">
									<table class="table card-table table-vcenter text-nowrap">
										<thead>
											<tr>
												<th>路径</th>
												<th>名称</th>
												<th></th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="template : ${templates}">
												<td th:text="${template.pattern}"></td>
												<td th:text="${template.name}"></td>
												<td><a href="javascript:void(0)"
													th:data-trash="${template.id}"><i class="fas fa-trash"></i></a><span
													class="mr-3"></span></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<footer th:replace="console/fragment/footer"></footer>
	</div>
	<script>
		document.getElementById('clear').addEventListener('click',function(){
			Swal.fire({
				  title: '确定清空吗？',
				  icon: 'warning',
				  showCancelButton: true,
				  confirmButtonColor: '#3085d6',
				  cancelButtonColor: '#d33'
				}).then((result) => {
				  if (result.value) {
					  	$.ajax({
							type : 'post',
							url : rootPath + 'console/previewTemplates/clear',
							success:function(data) {
								toast('清空成功');
								setTimeout(function(){
									window.location.reload();
								},800)
							}
						  })
				  }
				})
		})
		
		document.getElementById('merge').addEventListener('click',function(){
			Swal.fire({
				  title: '确定要保存吗？',
				  icon: 'warning',
				  showCancelButton: true,
				  confirmButtonColor: '#3085d6',
				  cancelButtonColor: '#d33'
				}).then((result) => {
				  if (result.value) {
					  	$.ajax({
							type : 'post',
							url : rootPath + 'console/previewTemplates/merge',
							success:function(data) {
								toast('合并成功');
								setTimeout(function(){
									window.location.reload();
								},800)
							}
						  })
				  }
				})
		})
		for(const ele of document.querySelectorAll('[data-trash]')){
			ele.addEventListener('click',function(){
				var id = this.dataset.trash;
				Swal.fire({
					  title: '确定删除吗？',
					  icon: 'warning',
					  showCancelButton: true,
					  confirmButtonColor: '#3085d6',
					  cancelButtonColor: '#d33'
					}).then((result) => {
					  if (result.value) {
						  	$.ajax({
								type : 'post',
								url : rootPath + 'console/previewTemplates/'+id+'/delete',
								success:function(data) {
									toast('删除成功');
									setTimeout(function(){
										window.location.reload();
									},800)
								}
							  })
					  }
					})
			});
		}
	</script>
</body>
</html>