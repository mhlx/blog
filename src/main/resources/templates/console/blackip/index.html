<!doctype html>
<html>
<head th:replace="console/fragment/head('黑名单管理')"></head>
<body class="">
	<div class="page">
		<div class="flex-fill">
			<div th:replace="console/fragment/profile"></div>
			<div th:replace="console/fragment/headermenu('blackip')"></div>
			<div class="my-3 my-md-5">
				<div class="container">
					<div class="page-header">
						<div class="page-options d-flex">
							<div class="input-icon ml-2">
								<a class="btn btn-primary" id="create-btn" href="javascript:void(0)"
									style="margin-left: 20px"> <i class="far fa-plus-square"></i>
								</a>
							</div>
						</div>
					</div>
					<div class="row row-deck">
						<div class="col-12">
							<div class="card">
								<div class="table-responsive">
									<table class="table card-table table-vcenter text-nowrap">
										<thead>
											<tr>
												<th>ip</th>
												<th></th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="blackip : ${blackips}">
												<td th:text="${blackip}"></td>
												<td><a href="javascript:void(0)"
													th:data-trash="${blackip}"><i class="fas fa-trash"></i></a><span
													class="mr-1"></span></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<footer th:replace="console/fragment/footer"></footer>
	</div>
	<script>
	
		document.getElementById('create-btn').addEventListener('click',function(){
			(async function getIP () {
				const { value: ip } = await Swal.fire({
					  title: 'ip',
					  input: 'text',
					  inputValue: '',
					  showCancelButton: true
					})
			    if (ip) {
				  $.ajax({
					type : 'POST',
					url : rootPath + 'console/blackip/save?ip='+ip,
					success:function(data) {
						toast('保存成功');
						setTimeout(function(){
							window.location.reload();
						},800)
					}
				  })
				}
			})()
		});
		
		for(const ele of document.querySelectorAll('[data-trash]')){
			ele.addEventListener('click',function(){
				var ip = this.dataset.trash;
				Swal.fire({
					  title: '确定删除吗？',
					  icon: 'warning',
					  showCancelButton: true,
					  confirmButtonColor: '#3085d6',
					  cancelButtonColor: '#d33'
					}).then((result) => {
					  if (result.value) {
						  	$.ajax({
								type : 'post',
								url : rootPath + 'console/blackip/delete?ip='+ip,
								success:function(data) {
									toast('删除成功');
									setTimeout(function(){
										window.location.reload();
									},800)
								}
							  })
					  }
					})
			});
		}
	</script>
</body>
</html>