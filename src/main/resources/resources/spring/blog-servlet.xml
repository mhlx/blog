<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="
	 http://www.springframework.org/schema/beans
	 http://www.springframework.org/schema/beans/spring-beans.xsd
	 http://www.springframework.org/schema/mvc
	 http://www.springframework.org/schema/mvc/spring-mvc.xsd
	 http://www.springframework.org/schema/context
	 http://www.springframework.org/schema/context/spring-context.xsd
	 http://www.springframework.org/schema/aop 
	 http://www.springframework.org/schema/aop/spring-aop-4.0.xsd
	 http://www.springframework.org/schema/task
	 http://www.springframework.org/schema/task/spring-task-4.0.xsd ">

	<import resource="template.xml" />

	<bean id="multipartResolver"
		class="org.springframework.web.multipart.support.StandardServletMultipartResolver" />

	<!-- 包扫描 -->
	<context:component-scan
		base-package="me.qyh.blog.web.controller,
			me.qyh.blog.template.render,
			me.qyh.blog.template.validator,
			me.qyh.blog.web.security,
			me.qyh.blog.template.service.impl,
			me.qyh.blog.web.view" />


<!-- 	<bean class="me.qyh.blog.web.security.ProxyIPGetter" /> -->

	<bean class="me.qyh.blog.template.render.TemplateRender" />

	<bean
		class="me.qyh.blog.template.render.thymeleaf.ThymeleafRenderExecutor" />
	<bean
		class="me.qyh.blog.template.render.thymeleaf.ThymleafTemplateExceptionTransalater" />

	<bean class="me.qyh.blog.file.store.local.ImageResourceStore"
		parent="thumbnailSupport">
		<property name="absPath" value="/web/file/blog_image/" />
		<property name="id" value="1" />
		<property name="thumbAbsPath"
			value="/web/file/blog_image_thumb" />
		<property name="sourceProtected" value="true" />
		<property name="name" value="图片存储" />
		<property name="animatedWebpConfigure">
			<bean class="me.qyh.blog.file.store.local.AnimatedWebpConfigure">
				<constructor-arg index="0" value="1" />
				<property name="sec" value="20" />
			</bean>
		</property>
	</bean>


<!-- 	<bean class="me.qyh.blog.file.store.local.VideoResourceStore" -->
<!-- 		parent="thumbnailSupport"> -->
<!-- 		<property name="absPath" value="/web/file/blog_video/" /> -->
<!-- 		<property name="id" value="4" /> -->
<!-- 		<property name="thumbAbsPath" -->
<!-- 			value="/web/file/blog_video_thumb" /> -->
<!-- 		<property name="name" value="视频存储" /> -->
<!-- 		<property name="maxSize" value="960" /> -->
<!-- 		<property name="readOnly" value="true" /> -->
<!-- 	</bean> -->

<!-- 	<bean class="me.qyh.blog.file.store.local.VideoResourceStore2" -->
<!-- 		parent="thumbnailSupport"> -->
<!-- 		<constructor-arg index="0" value="960" /> -->
<!-- 		<property name="absPath" value="/web/file/blog_video2/" /> -->
<!-- 		<property name="id" value="5" /> -->
<!-- 		<property name="thumbAbsPath" -->
<!-- 			value="/web/file/blog_video_thumb2" /> -->
<!-- 		<property name="name" value="视频存储" /> -->
<!-- 	</bean> -->

	<bean class="me.qyh.blog.file.store.local.Thumbnailator" />

	<bean id="thumbnailSupport"
		class="me.qyh.blog.file.store.local.ThumbnailSupport" abstract="true">
		<property name="supportWebp" value="true" />
		<property name="cacheSeconds" value="31556926" />
		<property name="smallResize">
			<bean class="me.qyh.blog.file.store.Resize">
				<constructor-arg value="200" />
			</bean>
		</property>
		<property name="middleResize">
			<bean class="me.qyh.blog.file.store.Resize">
				<constructor-arg value="600" />
			</bean>
		</property>
		<property name="largeResize">
			<bean class="me.qyh.blog.file.store.Resize">
				<constructor-arg value="900" />
			</bean>
		</property>
		<property name="resizeValidator">
			<bean class="me.qyh.blog.file.store.DefaultResizeValidator">
				<property name="allowSizes">
					<array>
						<value>64</value>
						<value>100</value>
						<value>160</value>
						<value>200</value>
						<value>400</value>
						<value>600</value>
						<value>900</value>
						<value>1300</value>
						<value>1920</value>
					</array>
				</property>
			</bean>
		</property>
	</bean>

	<bean class="me.qyh.blog.file.store.local.CommonResourceStore">
		<property name="absPath" value="/web/file/blog_file" />
		<property name="id" value="2" />
		<property name="name" value="文件存储" />
		<property name="cacheSeconds" value="31556926" />
	</bean>

	<bean class="me.qyh.blog.file.store.local.PrivateResourceStore">
		<property name="absPath" value="/web/file/blog_private" />
		<property name="id" value="3" />
		<property name="name" value="私人文件存储" />
		<property name="cacheSeconds" value="31556926" />
	</bean>

	<!-- <bean -->
	<!-- class="me.qyh.blog.file.store.local.GravatarResourceHttpRequestHandler"> -->
	<!-- <constructor-arg index="0" value="/web/file/gravatar" /> -->
	<!-- </bean> -->


	<aop:aspectj-autoproxy proxy-target-class="true" />

	<bean class="me.qyh.blog.web.interceptor.AppInterceptor" />
	<bean class="me.qyh.blog.web.WebConfiguration" />

	<bean class="me.qyh.blog.template.TemplateMapping" />
	<bean class="me.qyh.blog.web.WebExceptionResolver" />


	<bean class="me.qyh.blog.web.CookieMemoryLinkFlashMapManager"
		name="flashMapManager" />

	<bean class="me.qyh.blog.web.RememberMeService">
		<constructor-arg value="blog" />
	</bean>


</beans>